---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - index.html
  - src/style.css
  - src/spinner.js
  - src/main.js
autonomous: false
requirements:
  - DISP-01
  - DISP-02
  - DISP-03
  - CTRL-01
  - ANIM-01
  - ANIM-02
  - ANIM-03
  - ANIM-05
  - STAT-03
  - STAT-04

must_haves:
  truths:
    - "Circle renders centered on page with visible 3D perspective depth"
    - "Four directional buttons (up/down/left/right) are arranged spatially around the circle"
    - "Clicking up or down spins the circle on the X-axis continuously"
    - "Clicking left or right spins the circle on the Y-axis continuously"
    - "Spinning continues indefinitely until a different direction is clicked"
    - "All motion is CSS keyframes and transforms — no requestAnimationFrame or JS animation loops"
    - "DOM updates are driven by store.subscribe() callbacks"
  artifacts:
    - path: "index.html"
      provides: "Page structure with perspective container, circle element, directional buttons"
      contains: "spinner-container"
    - path: "src/style.css"
      provides: "3D perspective, keyframe animations for 4 directions, circle styling"
      contains: "@keyframes"
    - path: "src/spinner.js"
      provides: "Store subscription callbacks wiring state to DOM"
      exports: ["initSpinner"]
    - path: "src/main.js"
      provides: "Entry point importing and initializing spinner"
  key_links:
    - from: "src/spinner.js"
      to: "src/store.js"
      via: "store.subscribe() for state-driven DOM updates"
      pattern: "store\\.subscribe"
    - from: "src/spinner.js"
      to: "src/colors.js"
      via: "reads palette shades for CSS variable updates"
      pattern: "palette"
    - from: "src/spinner.js"
      to: "index.html"
      via: "querySelector for circle and button elements"
      pattern: "querySelector"
    - from: "index.html"
      to: "src/style.css"
      via: "CSS classes applied by spinner.js"
      pattern: "spin-up|spin-down|spin-left|spin-right"
---

<objective>
Build the visual layer — HTML structure, CSS 3D transforms/keyframes, and spinner.js orchestration — that turns the Zustand store into a working 3D spinning circle with directional controls.

Purpose: This is where the app comes alive. The data and state layer from Plan 01 gets wired to the DOM through subscribe callbacks, CSS handles all animation, and the user sees a spinning 3D circle responding to button clicks.
Output: A fully working 3D spinning circle app with directional button controls.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build index.html structure and style.css with 3D perspective and keyframes</name>
  <files>index.html, src/style.css</files>
  <action>
    Replace the Vite template `index.html` with:
    - Standard HTML5 doctype, charset, viewport meta
    - Link to `src/style.css` (Vite handles this via main.js import, but include for clarity)
    - Body structure:
      ```
      <div id="app">
        <div class="scene">          <!-- perspective container -->
          <div class="circle"></div>  <!-- the 3D spinning element -->
        </div>
        <div class="controls">
          <button data-direction="up" class="btn btn-up">Up</button>
          <button data-direction="left" class="btn btn-left">Left</button>
          <button data-direction="right" class="btn btn-right">Right</button>
          <button data-direction="down" class="btn btn-down">Down</button>
        </div>
      </div>
      ```
    - Buttons use `data-direction` attribute for JS event delegation
    - Script tag: `<script type="module" src="/src/main.js"></script>`

    Replace `src/style.css` with:
    - CSS reset (box-sizing, margin 0)
    - Body: flexbox centering, min-height 100vh, dark background (#1a1a2e or similar)
    - `.scene`: `perspective: 800px`, `transform-style: preserve-3d`, centered, sized (300x300px)
    - `.circle`: `width: 250px`, `height: 250px`, `border-radius: 50%`, centered within scene. Give it form with a gradient or border + box-shadow (e.g., `background: radial-gradient(circle, var(--spinner-color, #42a5f5) 0%, transparent 70%)` plus `border: 3px solid var(--spinner-color, #42a5f5)` and `box-shadow: 0 0 30px var(--spinner-color, #42a5f5)`). Use `transform-style: preserve-3d` on circle too.
    - CSS custom property `--spinner-color` on `.circle` defaulting to blue (#42a5f5)
    - Four `@keyframes` animations:
      - `spin-up`: `from { transform: rotateX(0deg); } to { transform: rotateX(360deg); }`
      - `spin-down`: `from { transform: rotateX(0deg); } to { transform: rotateX(-360deg); }`
      - `spin-left`: `from { transform: rotateY(0deg); } to { transform: rotateY(-360deg); }`
      - `spin-right`: `from { transform: rotateY(0deg); } to { transform: rotateY(360deg); }`
    - Four animation classes:
      - `.spin-up`: `animation: spin-up 2s linear infinite`
      - `.spin-down`: `animation: spin-down 2s linear infinite`
      - `.spin-left`: `animation: spin-left 2s linear infinite`
      - `.spin-right`: `animation: spin-right 2s linear infinite`
    - `.controls`: CSS Grid or flexbox arranged in a cross pattern (up top-center, left middle-left, right middle-right, down bottom-center). Use grid with named areas or absolute positioning within a square container.
    - `.btn`: styled buttons with padding, border-radius, visible borders, hover state. Use color that contrasts with dark background.
    - No `animation-play-state` yet — that's Phase 2 (stop/start controls)
  </action>
  <verify>
    - Open `index.html` in browser via Vite dev server: circle visible, centered, with 3D depth appearance
    - Manually add class `spin-right` to `.circle` in devtools: circle spins on Y-axis continuously
    - `grep -c "@keyframes" src/style.css` returns 4
    - `grep "perspective" src/style.css` shows `perspective: 800px`
    - `grep "preserve-3d" src/style.css` shows `transform-style: preserve-3d`
  </verify>
  <done>
    Circle element renders centered with visible 3D perspective. Four directional buttons arranged in cross layout. Four CSS keyframe animations defined for spin-up/down/left/right. All animation is pure CSS — no JS animation code. --spinner-color custom property is set with a default value.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire spinner.js orchestration with store subscriptions</name>
  <files>src/spinner.js, src/main.js</files>
  <action>
    Create `src/spinner.js`:
    - Import `store` from `./store.js`
    - Import `palette` from `./colors.js`
    - Export `initSpinner()` function that:

    1. **Grab DOM references:**
       - `const circle = document.querySelector('.circle')`
       - `const buttons = document.querySelectorAll('[data-direction]')`

    2. **Wire button click handlers (event delegation):**
       - For each button, add click listener that calls `store.getState().setDirection(button.dataset.direction)`
       - Use the `data-direction` attribute value directly

    3. **Subscribe: animation class updates (STAT-03, STAT-04):**
       - `store.subscribe((state, prevState) => { ... })` — Zustand vanilla subscribe gives (state, prevState)
       - When `state.direction` changes: remove all spin classes (`spin-up`, `spin-down`, `spin-left`, `spin-right`), add the matching class (`spin-${state.direction}`)
       - This is one subscribe callback dedicated to animation class concern (STAT-04)

    4. **Subscribe: color updates (STAT-04 — separate concern):**
       - Second `store.subscribe()` callback
       - When `state.colorFamily` or `state.shadeIndex` changes: read `palette[state.colorFamily].shades[state.shadeIndex]`, set `circle.style.setProperty('--spinner-color', shade)`
       - This is the second subscribe callback dedicated to color concern

    5. **Wire animationiteration event on circle:**
       - `circle.addEventListener('animationiteration', () => store.getState().cycleShade())`
       - This cycles the shade each time a full rotation completes
       - NOTE: This prepares shade cycling for Phase 2 color features, but is wired now since store already supports it

    Update `src/main.js`:
    - Import `./style.css` (Vite CSS import)
    - Import `initSpinner` from `./spinner.js`
    - Call `initSpinner()` on DOMContentLoaded or at module level (module scripts are deferred by default, so direct call is fine)

    **Important constraints:**
    - NO `requestAnimationFrame` anywhere — all animation is CSS
    - NO direct DOM manipulation outside subscribe callbacks (except initial setup)
    - Subscribe callbacks check if relevant state actually changed before doing DOM work
  </action>
  <verify>
    - `npm run dev`, open browser, click "Right" button: circle spins on Y-axis continuously
    - Click "Up" button: circle switches to X-axis rotation
    - Click "Left" button: circle switches to opposite Y-axis rotation
    - Browser devtools console: `window.__store = (await import('/src/store.js')).store; __store.getState()` shows current state
    - `grep -c "subscribe" src/spinner.js` returns 2 (two separate subscribe callbacks)
    - `grep "requestAnimationFrame" src/spinner.js` returns nothing (no JS animation loops)
  </verify>
  <done>
    Clicking any directional button spins the circle on the correct axis (up/down=X, left/right=Y). Spinning is continuous and infinite until a different direction is clicked. Two separate store.subscribe() callbacks handle animation class and color concerns independently. No JavaScript animation loops — all motion is CSS keyframes. shade cycling wired via animationiteration event.
  </done>
</task>

<task type="checkpoint:human-verify" gate="soft">
  <name>Task 3: Verify 3D spinning circle works end-to-end</name>
  <files>none</files>
  <action>
    Human verification checkpoint. What was built: Complete Phase 1 spinning circle — 3D circle with perspective depth, four directional buttons, Zustand-driven state, CSS-only animation.

    How to verify:
    1. Run `npm run dev` and open http://localhost:5173
    2. Verify circle is centered on page with visible 3D depth (gradient/shadow gives form)
    3. Click "Up" — circle spins on X-axis (rotating forward/backward)
    4. Click "Down" — circle spins on X-axis in opposite direction
    5. Click "Left" — circle spins on Y-axis (rotating left)
    6. Click "Right" — circle spins on Y-axis in opposite direction
    7. Confirm spinning is smooth and continuous (not jerky, not stopping)
    8. Click a different direction while spinning — should switch immediately
    9. Open devtools Console, run: `(await import('/src/store.js')).store.getState()` — verify state shape has direction, isSpinning, colorFamily, shadeIndex
  </action>
  <verify>User confirms visual and interactive behavior matches expectations</verify>
  <done>User types "approved" or describes issues to address</done>
</task>

</tasks>

<verification>
1. Circle renders centered with 3D perspective depth (visible form from gradient/shadow/border)
2. Parent `.scene` has `perspective: 800px` and `transform-style: preserve-3d`
3. Four directional buttons arranged spatially (cross pattern)
4. Up/Down spin on X-axis, Left/Right spin on Y-axis
5. Spinning is continuous (infinite) until direction change
6. `grep "requestAnimationFrame" src/` returns nothing
7. `grep -c "subscribe" src/spinner.js` returns 2
8. Store state accessible and shows correct shape
</verification>

<success_criteria>
- Circle is visible, centered, and has 3D depth appearance
- All 4 directional buttons trigger correct axis rotation
- Rotation is continuous and smooth (CSS keyframes at 60fps)
- No JS animation loops anywhere in codebase
- Two separate subscribe callbacks (animation + color) in spinner.js
- Store state correctly reflects user interactions
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
